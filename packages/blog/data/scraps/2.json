{"number":2,"id":"I_kwDOK-znbM56vpCz","title":"Zenn ã® Scraps çš„ãªã‚‚ã®ã‚’ GitHub Issues ã‚’ CMS ã¨ã—ã¦å®Ÿç¾ã™ã‚‹","body":"## è¦ä»¶\r\n\r\n- é€æ¬¡ã€ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³çš„ãªå½¢ã§æ›´æ–°ã§ãã‚‹\r\n- Markdown ã§å…¥åŠ›ã§ãã‚‹\r\n- ã‚¯ãƒ­ãƒ¼ã‚ºã§ãã‚‹\r\n- ã‚¿ã‚°ã‚’ã¤ã‘ã‚‰ã‚Œã‚‹\r\n  - ãƒ–ãƒ­ã‚°è¨˜äº‹ã¨å…±æœ‰ã™ã‚‹\r\n    - https://www.codingfeline.com/tags/ ã«ã¾ã¨ã‚ã¦è¡¨ç¤ºã§ãã‚‹\r\n- ãƒ–ãƒ­ã‚°æœ¬ä½“ã®ãƒ‡ãƒ—ãƒ­ã‚¤æ¯ã« GitHub API ã‚’ä½¿ã„ã™ããªã„ã‚ˆã†ã«ã™ã‚‹\r\n  - Issue ã®æ›´æ–°ãƒˆãƒªã‚¬ãƒ¼ã§ JSON ã‚’ç”Ÿæˆã™ã‚‹ã‚ˆã†ãªæ„Ÿã˜ãŒã‚ˆã•ã\r\n- ä¸¦ã³é †ã¯ä½œæˆã®é™é †ï¼Ÿ\r\n- å„ã‚³ãƒ¡ãƒ³ãƒˆã«ã‚¢ãƒ³ã‚«ãƒ¼ã¤ã‘ãŸã„","state":"open","tags":["GitHub","VitePress","Vue.js"],"originUrl":"https://github.com/yshrsmz/scraps/issues/2","createdAt":"2023-12-29T10:50:59Z","updatedAt":"2024-01-01T16:38:57Z","comments":[{"body":"- ã—ã‹ã—ã€JSONç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯ã‚’ Scrap ç®¡ç†ç”¨ãƒ¬ãƒã‚¸ãƒˆãƒªã«å…¥ã‚Œã¦ã—ã¾ã†ã¨ã‚³ãƒ¼ãƒ‰ãŒåˆ†æ•£ã—ã¦ã—ã¾ã†\r\n  - Custom Action ã‚’ yshrsmz.github.io ã®æ–¹ã«ä½œæˆã—ã€ãã‚Œã‚’ã“ã®ãƒ¬ãƒã‚¸ãƒˆãƒªã‹ã‚‰ä½¿ã†ï¼Ÿ\r\n  - issues ãƒˆãƒªã‚¬ãƒ¼ã§ã€issue å˜ä½ã® JSON ã‚’ä½œæˆ/æ›´æ–° -> ã‚³ãƒŸãƒƒãƒˆ -> push ãƒˆãƒªã‚¬ãƒ¼ã§ãƒ–ãƒ­ã‚°æ›´æ–°\r\n    - https://docs.github.com/ja/actions/using-workflows/events-that-trigger-workflows#issues\r\n  - PAT ãŒå¿…è¦ã«ãªã‚‹ãŒã€ã¾ã‚è‡´ã—æ–¹ãªã—\r\n  - reusable workflow ã¨ã—ã¦å…±æœ‰ã§ããã†\r\n    - https://docs.github.com/en/actions/using-workflows/reusing-workflows#access-to-reusable-workflows","createdAt":"2023-12-29T10:56:53Z","updatedAt":"2023-12-29T15:50:53Z","id":"IC_kwDOK-znbM5vk65y"},{"body":"```yml\r\n# yshrsmz/scraps\r\nname: dispatch scrap update\r\n\r\non:\r\n  issues:\r\n  issue_comment:\r\n\r\njobs:\r\n  create-scrap:\r\n    # yshrsmz.github.io ã® workflow ã‚’å‚ç…§\r\n    uses: yshrsmz/yshrsmz.github.io/.github/workflows/_create-scrap.yml@scraps\r\n    with:\r\n      issue_number: ${{ github.event.issue.number }}\r\n    secrets:\r\n      target_github_token: ${{ secrets.GITHUB_TOKEN }}\r\n\r\n```\r\n\r\n```yml\r\n# _create-scrap.yml\r\njobs:\r\n  create-scrap:\r\n    runs-on: ubuntu-latest\r\n    steps:\r\n      - name: create scrap\r\n        # action ã‚‚ workflow ã‚‚åŒã˜ãƒ¬ãƒã‚¸ãƒˆãƒªå†…ã§ã¯ã‚ã‚‹ãŒã€ã“ã“ã‚‚ãƒ•ãƒ«ãƒ‘ã‚¹ã§æŒ‡å®šã™ã‚‹å¿…è¦æœ‰ã‚Š\r\n        uses: yshrsmz/yshrsmz.github.io/packages/action-create-scrap@scraps\r\n        with:\r\n          issue_number: ${{ github.event.inputs.issue_number }}\r\n          github_token: ${{ secrets.target_github_token }}\r\n\r\n```","createdAt":"2023-12-30T08:04:02Z","updatedAt":"2023-12-30T08:04:02Z","id":"IC_kwDOK-znbM5vm8KG"},{"body":"repository_dispatch ã™ã‚‹ã‹ã€ yshrsmz.github.io ã‚’ clone & push ã™ã‚‹ã‹\r\n\r\nrepository_dispatch ã ã¨å„ãƒ¬ãƒã‚¸ãƒˆãƒªã§ PAT ãŒå¿…è¦ã«ãªã‚‹ã‹ã‚‰ã€ clone & push ã®ã»ã†ãŒæ¥½ã½ã„","createdAt":"2023-12-30T14:32:41Z","updatedAt":"2023-12-30T14:35:03Z","id":"IC_kwDOK-znbM5vnKyp"},{"body":"ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã€ã“ã‚Œã§ã„ã‘ã‚‹ã‚‰ã—ã„\r\n\r\n```ts\r\nconst comments = await octokit.paginate(\r\n    octokit.rest.issues.listComments,\r\n    {\r\n      ...repo,\r\n      issue_number: issueNumber,\r\n      per_page: 10,\r\n    },\r\n    (response) => response.data,\r\n  )\r\n```","createdAt":"2023-12-30T16:09:12Z","updatedAt":"2023-12-30T16:09:12Z","id":"IC_kwDOK-znbM5vnPKL"},{"body":"commit ã¯ git config ãŒå¿…è¦\r\ncredential ã¯ `@actions/core` ã« `token` ã‚’ä¸ãˆã‚‹ã¨ persist ã—ã¦ãã‚Œã‚‹","createdAt":"2023-12-30T16:12:34Z","updatedAt":"2023-12-30T16:12:34Z","id":"IC_kwDOK-znbM5vnPS6"},{"body":"vitepress ã§ JSON ã‹ã‚‰ãƒšãƒ¼ã‚¸ã‚’æç”»ã™ã‚‹ã«ã¯\r\n\r\n- dynamic routing ç”¨ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«\r\n  - https://vitepress.dev/guide/routing#dynamic-routes\r\n- data loader\r\n  - https://vitepress.dev/guide/data-loading#data-from-local-files\r\n  - https://vitepress.dev/guide/cms\r\n\r\nãŒå¿…è¦","createdAt":"2023-12-31T04:37:09Z","updatedAt":"2023-12-31T04:37:09Z","id":"IC_kwDOK-znbM5vnqh-"},{"body":"- `paths loader` ã¯æœ¬æ–‡ã‚’ `content` ã¨ã—ã¦æ¸¡ã™ã“ã¨ãŒã§ãã‚‹ãŒã€html ã‹ Markdown ã‚’æƒ³å®šã—ã¦ã„ã‚‹ã‚ˆã†ãªã®ã§ã€ä»Šå›ã®ç”¨é€”ã«ã¯åˆã‚ãªã„ \r\n- `data loader` ã‚’åˆ¥ã§ä½œã‚‹å¿…è¦ã‚ã‚Š\r\n  - GitHub REST Api ã¯ issue ã‚„ comment ã‚’ plain text ã§è¿”ã™ã®ã§ã€ `data loader` ã§ MarkdownIt ã‚’ã‹ã¾ã›ã‚‹å¿…è¦ã‚ã‚Š\r\n\r\n\r\n```ts\r\nimport { createMarkdownRenderer, type SiteConfig } from 'vitepress'\r\n\r\nexport default {\r\n  watch: ['data/scraps/*.json'],\r\n  async load(watchedFiles: string[]) {\r\n    // config ã¯ VITEPRESS_CONFIG\r\n    const config: SiteConfig = (global as any).VITEPRESS_CONFIG\r\n\r\n    const md = await createMarkdownRenderer(\r\n      // ...\r\n    )\r\n\r\n    return watchedFiles\r\n      .map((file) => readFileSync(file, 'utf-8'))\r\n      .map<Scrap>((json) => JSON.parse(json))\r\n      .map((scrap) => {\r\n        return {\r\n          ...scrap,\r\n          body: md.render(scrap.body),\r\n          comments: ... // comments ã® body ã‚‚ md.render() ã™ã‚‹\r\n        }\r\n      })\r\n  }\r\n}\r\n``` ","createdAt":"2023-12-31T08:52:52Z","updatedAt":"2023-12-31T08:52:52Z","id":"IC_kwDOK-znbM5vocOr"},{"body":"```shell\r\necho '${{ needs.create-scrap.outputs.output }}' > ./packages/blog/data/scraps/${{ github.event.issue.number }}.json\r\n```\r\n\r\nã ã¨ã€JSON ã«å«ã¾ã‚Œã‚‹ single quote ãŒæ¶ˆãˆã¦ã—ã¾ã† ğŸ¤” ","createdAt":"2023-12-31T16:20:23Z","updatedAt":"2023-12-31T16:41:14Z","id":"IC_kwDOK-znbM5vo4Ol"},{"body":"ä¸€åº¦ç’°å¢ƒå¤‰æ•°ã«å…¥ã‚Œã¦ã‚ã’ã‚Œã°ã„ã‘ãã†\r\n\r\n```yml\r\n- run: |\r\n    echo $SCRAP_JSON > ./packages/blog/data/scraps/${{ github.event.issue.number }}.json\r\n  env:\r\n    SCRAP_JSON: ${{ needs.create-scrap.outputs.output }}\r\n```","createdAt":"2023-12-31T16:46:35Z","updatedAt":"2023-12-31T16:46:35Z","id":"IC_kwDOK-znbM5vo5d8"},{"body":"å¤‰æ•°ãƒ‘ã‚¿ãƒ¼ãƒ³ã ã¨é€£ç¶šã—ãŸã‚¹ãƒšãƒ¼ã‚¹ãŒã¾ã¨ã‚ã‚‰ã‚Œã¡ã‚ƒã£ã¦ãã†ã€‚ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆãŒå´©ã‚Œã‚‹ã€‚\r\n\r\ndouble quote ã§å›²ã£ã¦ã‚ã’ã‚‹ã¨ã„ã‘ã‚‹\r\n\r\n```diff\r\n  - run: |\r\n-     echo $SCRAP_JSON > ./packages/blog/data/scraps/${{ github.event.issue.number }}.json\r\n+     echo \"$SCRAP_JSON\" > ./packages/blog/data/scraps/${{ github.event.issue.number }}.json\r\n    env:\r\n      SCRAP_JSON: ${{ needs.create-scrap.outputs.output }}\r\n```\r\n\r\n- [bash - Why does my shell script choke on whitespace or other special characters? - Unix & Linux Stack Exchange](https://unix.stackexchange.com/questions/131766/why-does-my-shell-script-choke-on-whitespace-or-other-special-characters)\r\n","createdAt":"2024-01-01T05:50:15Z","updatedAt":"2024-01-01T05:58:57Z","id":"IC_kwDOK-znbM5vplKv"},{"body":"ã‚¢ãƒ³ã‚«ãƒ¼ã¯ issue/comment ã® `node_id` ã‚’ä½¿ã†ã¨è‰¯ã•ãã†ã€‚\r\n`node_id` ã¯ GraphQL API ã® `id` ã«ç›¸å½“ã™ã‚‹ã®ã§ã€å°†æ¥çš„ã«(ã‚ã‚‹ã‹ã©ã†ã‹çŸ¥ã‚‰ã‚“ã‘ã©) GraphQL API ã«ä¹—ã‚Šæ›ãˆã‚‹ã¨ã—ãŸã‚‰ã¯ã‹ã©ã‚Šã\r\n\r\n- [ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒãƒ¼ãƒ‰IDã®åˆ©ç”¨ - GitHub Docs](https://docs.github.com/ja/graphql/guides/using-global-node-ids)\r\n","createdAt":"2024-01-01T16:27:25Z","updatedAt":"2024-01-01T16:27:25Z","id":"IC_kwDOK-znbM5vqas-"},{"body":"æ®‹ä½œæ¥­\r\n\r\n- å¯¾è±¡ issue ã®é™å®šæ–¹æ³•\r\n  - æŒ‡å®šã®ã€€label ãŒã¤ã„ãŸ issue ã‚’ exclude ã™ã‚‹ã‹ include ã™ã‚‹ã‹\r\n- â†‘ã®æ–¹æ³•ã§å¾Œæ—¥æ›´æ–°ã•ã‚Œã¦å¯¾è±¡ã«å«ã¾ã‚Œãªããªã£ãŸ issue ã‚’ã©ã†ã‚„ã£ã¦å‰Šé™¤ã™ã‚‹ã‹","createdAt":"2024-01-01T16:38:56Z","updatedAt":"2024-01-01T16:38:56Z","id":"IC_kwDOK-znbM5vqbkm"}]}
