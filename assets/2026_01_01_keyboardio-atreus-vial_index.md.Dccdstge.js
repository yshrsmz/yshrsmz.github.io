import{_ as e,o as s,a as n,X as i}from"./chunks/framework.BPPv2K3c.js";const E=JSON.parse('{"title":"Keyboardio Atreus を Vial で使う","description":"","frontmatter":{"layout":"post","title":"Keyboardio Atreus を Vial で使う","category":"diary","tags":["keyboard"],"head":[["link",{"rel":"canonical","href":"https://www.codingfeline.com/2026/01/01/keyboardio-atreus-vial/"}],["meta",{"property":"og:url","content":"https://www.codingfeline.com/2026/01/01/keyboardio-atreus-vial/"}],["meta",{"property":"og:title","content":"Keyboardio Atreus を Vial で使う"}],["meta",{"property":"twitter:card","content":"summary_large_image"}],["meta",{"property":"twitter:site","content":"@_yshrsmz"}],["meta",{"property":"twitter:creator","content":"@_yshrsmz"}],["meta",{"property":"og:image","content":"https://www.codingfeline.com/2026/01/01/keyboardio-atreus-vial/ogp.png"}]]},"headers":[],"relativePath":"2026/01/01/keyboardio-atreus-vial/index.md","filePath":"posts/2026/2026-01-01-keyboardio-atreus-vial.md","date":{"time":"2026-01-01","string":"January 1, 2026","year":"2026","month":"01","day":"01"}}'),l={name:"2026/01/01/keyboardio-atreus-vial/index.md"};function o(p,a,r,t,d,c){return s(),n("div",null,[...a[0]||(a[0]=[i(`<p>Keyboardio Atreus のファームウェアを vial-qmk に載せ替えて、Vial でキーマップやコンボを管理できるようにした話。</p><p><strong>目次</strong></p><nav class="table-of-contents"><ul><li><a href="#はじめに">はじめに</a></li><li><a href="#vial-qmk-を使う">vial-qmk を使う</a></li><li><a href="#qmk-settings-を有効にするためのパッチ">QMK_SETTINGS を有効にするためのパッチ</a><ul><li><a href="#パッチの解説">パッチの解説</a></li></ul></li><li><a href="#ビルドとフラッシュ">ビルドとフラッシュ</a></li><li><a href="#おまけ-無効にする機能の割り出し方">おまけ: 無効にする機能の割り出し方</a></li><li><a href="#まとめ">まとめ</a></li><li><a href="#参考">参考</a></li></ul></nav><h2 id="はじめに" tabindex="-1">はじめに <a class="header-anchor" href="#はじめに" aria-label="Permalink to &quot;はじめに&quot;">​</a></h2><p>Keyboardio Atreus はデフォルトで Chrysalis というファームウェアを使っている。Chrysalis でもキーマップの変更はできるのだが、コンボやタップダンスといった高度な設定を GUI で行うことができない。</p><p>最近 Cornix で Vial を使うようになり、その便利さを実感している。リアルタイムでキーマップを変更できる手軽さは一度味わうと戻れない。そこで Atreus でも Vial を使えるようにしたいと思った。</p><h2 id="vial-qmk-を使う" tabindex="-1">vial-qmk を使う <a class="header-anchor" href="#vial-qmk-を使う" aria-label="Permalink to &quot;vial-qmk を使う&quot;">​</a></h2><p>Vial 公式が <a href="https://github.com/vial-kb/vial-qmk" target="_blank" rel="noreferrer">vial-qmk</a> という QMK ファームウェアのフォークをメンテナンスしている。Keyboardio Atreus 用の設定も含まれているので、これを使えば Vial を導入できる。各キーボードディレクトリの、<code>keymaps/vial</code> を利用する。</p><p>ただし、デフォルトの設定だと <code>QMK_SETTINGS</code> が無効になっている。<code>QMK_SETTINGS</code> を有効にすると、Vial の GUI から以下のような設定を調整できるようになる。</p><ul><li>タップダンスのタイミング調整</li><li>ロングタップ（Mod-Tap）の判定時間</li><li>同時押し時のホールドモードへの即時切り替え</li><li>その他 QMK 系ファームウェアの細かな挙動</li></ul><p>これらの設定を GUI で調整できるのは非常に便利なので、有効にしたい。</p><h2 id="qmk-settings-を有効にするためのパッチ" tabindex="-1">QMK_SETTINGS を有効にするためのパッチ <a class="header-anchor" href="#qmk-settings-を有効にするためのパッチ" aria-label="Permalink to &quot;QMK_SETTINGS を有効にするためのパッチ&quot;">​</a></h2><p>問題は、<code>QMK_SETTINGS</code> を有効にするとファームウェアのサイズが増えて、Atreus のフラッシュメモリに収まらなくなること。そこで、使わない QMK の機能を無効化してファームウェアサイズを削減し、<code>QMK_SETTINGS</code> のための容量を確保する。</p><p>以下のパッチを <a href="https://github.com/vial-kb/vial-qmk" target="_blank" rel="noreferrer">vial-qmk</a> に当てる。対象コミットは <code>ab824d6becfdb3dfcbc08041649612ea1906f8d5</code>。もちろん最新のコミットを使ってもらうのがいいんだけど、qmk や qmk-vial の機能追加によっては以下の内容だと足りない可能性もあるのでよしなに調整してください。</p><div class="language-patch vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">patch</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>diff --git a/keyboards/keyboardio/atreus/keymaps/vial/config.h b/keyboards/keyboardio/atreus/keymaps/vial/config.h</span></span>
<span class="line"><span>index f2e336b..2dc4978 100644</span></span>
<span class="line"><span>--- a/keyboards/keyboardio/atreus/keymaps/vial/config.h</span></span>
<span class="line"><span>+++ b/keyboards/keyboardio/atreus/keymaps/vial/config.h</span></span>
<span class="line"><span>@@ -8,4 +8,6 @@</span></span>
<span class="line"><span> #define VIAL_UNLOCK_COMBO_COLS { 0, 1, 7, 10, 11}</span></span>
<span class="line"><span> </span></span>
<span class="line"><span> #define DYNAMIC_KEYMAP_LAYER_COUNT 4</span></span>
<span class="line"><span>- </span></span>
<span class="line"><span>+</span></span>
<span class="line"><span>+// #define VIAL_TAP_DANCE_ENTRIES 8</span></span>
<span class="line"><span>+// #define VIAL_COMBO_ENTRIES 8</span></span>
<span class="line"><span>diff --git a/keyboards/keyboardio/atreus/keymaps/vial/rules.mk b/keyboards/keyboardio/atreus/keymaps/vial/rules.mk</span></span>
<span class="line"><span>index 35d359f..42f5412 100644</span></span>
<span class="line"><span>--- a/keyboards/keyboardio/atreus/keymaps/vial/rules.mk</span></span>
<span class="line"><span>+++ b/keyboards/keyboardio/atreus/keymaps/vial/rules.mk</span></span>
<span class="line"><span>@@ -1,7 +1,16 @@</span></span>
<span class="line"><span> VIA_ENABLE = yes</span></span>
<span class="line"><span> VIAL_ENABLE = yes</span></span>
<span class="line"><span> LTO_ENABLE = yes</span></span>
<span class="line"><span>-QMK_SETTINGS = no</span></span>
<span class="line"><span>+QMK_SETTINGS = yes</span></span>
<span class="line"><span> CONSOLE_ENABLE = no</span></span>
<span class="line"><span> COMMAND_ENABLE = no</span></span>
<span class="line"><span>-</span></span>
<span class="line"><span>+UNICODE_ENABLE = no</span></span>
<span class="line"><span>+MOUSEKEY_ENABLE = no</span></span>
<span class="line"><span>+KEY_OVERRIDE_ENABLE = no</span></span>
<span class="line"><span>+LAYER_LOCK_ENABLE = no</span></span>
<span class="line"><span>+REPEAT_KEY_ENABLE = no</span></span>
<span class="line"><span>+CAPS_WORD_ENABLE = no</span></span>
<span class="line"><span>+NKRO_ENABLE = no</span></span>
<span class="line"><span>+SPACE_CADET_ENABLE = no</span></span>
<span class="line"><span>+GRAVE_ESC_ENABLE = no</span></span>
<span class="line"><span>+MAGIC_ENABLE = no</span></span></code></pre></div><h3 id="パッチの解説" tabindex="-1">パッチの解説 <a class="header-anchor" href="#パッチの解説" aria-label="Permalink to &quot;パッチの解説&quot;">​</a></h3><p>このパッチでは以下の変更を行っている:</p><p><strong>config.h の変更:</strong></p><ul><li><code>VIAL_TAP_DANCE_ENTRIES</code> と <code>VIAL_COMBO_ENTRIES</code> の行をコメントアウト（デフォルト値を使用）</li></ul><p><strong>rules.mk の変更:</strong></p><ul><li><code>QMK_SETTINGS = yes</code> に変更して QMK Settings を有効化</li><li>以下の機能を無効化してファームウェアサイズを削減: <ul><li><code>UNICODE_ENABLE</code> - Unicode 入力（使わない）</li><li><code>MOUSEKEY_ENABLE</code> - マウスキー（使わない）</li><li><code>KEY_OVERRIDE_ENABLE</code> - キーオーバーライド</li><li><code>LAYER_LOCK_ENABLE</code> - レイヤーロック</li><li><code>REPEAT_KEY_ENABLE</code> - リピートキー</li><li><code>CAPS_WORD_ENABLE</code> - Caps Word</li><li><code>NKRO_ENABLE</code> - N-Key Rollover（6KRO で十分）</li><li><code>SPACE_CADET_ENABLE</code> - Space Cadet Shift</li><li><code>GRAVE_ESC_ENABLE</code> - Grave Escape</li><li><code>MAGIC_ENABLE</code> - Magic キーコード</li></ul></li></ul><p>これらは自分の使い方では不要な機能なので無効化している。必要に応じて有効にしても良いが、ファームウェアサイズには注意が必要。</p><h2 id="ビルドとフラッシュ" tabindex="-1">ビルドとフラッシュ <a class="header-anchor" href="#ビルドとフラッシュ" aria-label="Permalink to &quot;ビルドとフラッシュ&quot;">​</a></h2><p>パッチを当てたら、以下のコマンドでビルドとフラッシュを行う:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> keyboardio/atreus:vial:flash</span></span></code></pre></div><p>コマンドを実行すると、ビルド完了後にブートローダー待機状態になる。この状態で Atreus をブートローダーモードにする（ESC を押しながら USB を接続）と、自動的にフラッシュが実行される。</p><p>フラッシュが完了したら、<a href="https://get.vial.today/" target="_blank" rel="noreferrer">Vial</a> を起動してキーボードが認識されることを確認する。</p><h2 id="おまけ-無効にする機能の割り出し方" tabindex="-1">おまけ: 無効にする機能の割り出し方 <a class="header-anchor" href="#おまけ-無効にする機能の割り出し方" aria-label="Permalink to &quot;おまけ: 無効にする機能の割り出し方&quot;">​</a></h2><p>どうやって無効にするフラグを決めたかというと、Claude Code にファームウェアのビルドを繰り返し実行してもらった。</p><p>QMK のビルド（<code>make keyboardio/atreus:vial</code>）は、ファームウェアサイズが上限を超えるとエラーになり、どれだけオーバーしているかを表示してくれる。このエラーメッセージを見ながら、Claude Code に「サイズを削減するために無効にできる機能を探して」と指示すると、<code>rules.mk</code> の設定を試行錯誤してくれる。</p><p>ただし、たまに使いたい機能まで無効にしてしまうことがある。そういう場合は、</p><ul><li>事前に「<code>TAP_DANCE_ENABLE</code> は残しておいて」と伝えておく</li><li>無効にされたら「それは使いたいから戻して」とフィードバックする</li></ul><p>こうしたやり取りを繰り返すことで、自分にとって不要な機能だけを無効化し、必要な機能を残したまま <code>QMK_SETTINGS</code> を有効にできるサイズに収めることができた。</p><h2 id="まとめ" tabindex="-1">まとめ <a class="header-anchor" href="#まとめ" aria-label="Permalink to &quot;まとめ&quot;">​</a></h2><p>Keyboardio Atreus に Vial を導入することで、GUI からリアルタイムにキーマップやコンボ、タップダンスの設定を変更できるようになった。さらに <code>QMK_SETTINGS</code> を有効にしたことで、各種タイミング設定も GUI から調整できる。</p><p>Chrysalis と比べて設定の自由度が大幅に上がるので、Atreus ユーザーにはおすすめです。</p><h2 id="参考" tabindex="-1">参考 <a class="header-anchor" href="#参考" aria-label="Permalink to &quot;参考&quot;">​</a></h2><ul><li><a href="https://github.com/vial-kb/vial-qmk/tree/vial/keyboards/keyboardio/atreus" target="_blank" rel="noreferrer">vial-qmk/keyboards/keyboardio/atreus at vial · vial-kb/vial-qmk</a></li><li><a href="https://docs.qmk.fm/config_options#feature-options" target="_blank" rel="noreferrer">Configuring QMK | QMK Firmware</a></li><li><a href="https://get.vial.today/docs/firmware-size.html#qmk-settings" target="_blank" rel="noreferrer">Select Vial GUI features (for size) - Vial</a></li><li><a href="https://chrysalis.keyboard.io/" target="_blank" rel="noreferrer">Chrysalis</a></li></ul>`,38)])])}const k=e(l,[["render",o]]);export{E as __pageData,k as default};
