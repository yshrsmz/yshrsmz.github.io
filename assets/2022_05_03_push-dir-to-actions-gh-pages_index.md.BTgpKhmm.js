import{_ as i,a,o as e,X as t}from"./chunks/framework.Cp7KI1mb.js";const c=JSON.parse('{"title":"GitHub Pages のデプロイを push-dir から peaceiris/actions-gh-pages に移行した","description":"","frontmatter":{"layout":"post","title":"GitHub Pages のデプロイを push-dir から peaceiris/actions-gh-pages に移行した","category":"programming","tags":["GitHub","GitHub Actions","GitHub Pages"],"head":[["link",{"rel":"canonical","href":"https://www.codingfeline.com/2022/05/03/push-dir-to-actions-gh-pages/"}],["meta",{"property":"og:url","content":"https://www.codingfeline.com/2022/05/03/push-dir-to-actions-gh-pages/"}],["meta",{"property":"og:title","content":"GitHub Pages のデプロイを push-dir から peaceiris/actions-gh-pages に移行した"}],["meta",{"property":"twitter:card","content":"summary_large_image"}],["meta",{"property":"twitter:site","content":"@_yshrsmz"}],["meta",{"property":"twitter:creator","content":"@_yshrsmz"}],["meta",{"property":"og:image","content":"https://www.codingfeline.com/2022/05/03/push-dir-to-actions-gh-pages/ogp.png"}]]},"headers":[],"relativePath":"2022/05/03/push-dir-to-actions-gh-pages/index.md","filePath":"posts/2022/2022-05-03-push-dir-to-actions-gh-pages.md","date":{"time":"2022-05-03","string":"May 3, 2022","year":"2022","month":"05","day":"03"}}'),p={name:"2022/05/03/push-dir-to-actions-gh-pages/index.md"};function n(r,s,h,l,o,g){return e(),a("div",null,[...s[0]||(s[0]=[t(`<p>掲題の通り。<br><a href="https://github.com/L33T-KR3W/push-dir" target="_blank" rel="noreferrer">push-dir</a> のメンテが止まってる &amp; <a href="https://github.com/advisories/GHSA-926x-m6m5-3mmp" target="_blank" rel="noreferrer">脆弱性がある</a> ということで、重い腰を上げて <a href="https://github.com/peaceiris/actions-gh-pages" target="_blank" rel="noreferrer">peaceiris/actions-gh-pages</a> に移行した。</p><div class="language-yml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Deploy website</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    git remote add upstream https://\${{ secrets.PUSH_ACCESS_TOKEN }}@github.com/\${{ secrets.USER_NAME }}/\${{ secrets.REPO_NAME }}.git</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    yarn push-dir --dir=packages/site/dist --remote=upstream --branch=master --clearnup --verbose</span></span></code></pre></div><p>これが</p><div class="language-yml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Deploy website</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  uses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">peaceiris/actions-gh-pages@v3</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    personal_token</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\${{ secrets.PUSH_ACCESS_TOKEN }}</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    publish_dir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./packages/site/dist</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    publish_branch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">master</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    force_orphan</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span></code></pre></div><p>こうなった。</p><p><a href="https://github.com/peaceiris/actions-gh-pages" target="_blank" rel="noreferrer">peaceiris/actions-gh-pages</a> は <code>secrets.GITHUB_TOKEN</code> でのデプロイにも対応している。</p><p>ただ、ちょっと試した感じだと <code>secrets.GITHUB_TOKEN</code> だとデプロイ完了後の <code>page_build</code> イベントがトリガーされず、後処理の別のワークフローが動かなかった。<br> そのため push-dir のときと同様に PAT を利用している。</p><p>そのうちトークンは PAT から <a href="https://github.com/tibdex/github-app-token" target="_blank" rel="noreferrer">tibdex/github-app-token</a> に移行したい。</p>`,8)])])}const d=i(p,[["render",n]]);export{c as __pageData,d as default};
