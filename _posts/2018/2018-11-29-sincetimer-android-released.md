---
layout: post
title: 最後にあれしたのいつだっけ？をトラッキングするAndroidアプリ、SinceTimerをリリースしてた
category: programming
tags:
  - android
  - sincetimer
---

![feature](/assets/img/products/sincetimer/feature.png)

掲題のとおり、今年の7月末にアプリを[Google Play Storeに公開していました](https://play.google.com/store/apps/details?id=com.codingfeline.sincetimer)。  

名前は"SinceTimer(シンスタイマー)"です。

「最後に映画観たのいつだっけ？」とか「最後にラーメン食べたのいつだっけ？」とかいった情報を管理するためのアプリです。

---

## 画面

トップ画面はこんな感じで

![トップ](https://lh3.googleusercontent.com/wa4DdOgjUmwgAwEfdYNZnGE2xN0GOXOMnRboZz96emTmIK0QAqsk_dsmGdnLZA4RJJlmWHCTRAUzuvrZfil34sUlDY6FiuJNmWi_7KsVHxLA6Na4xSYauLXr72bUKxMfSavvko6oyVeYmDbWQ4MsDw5tp1dNtc5TCZ1vU9h9QYzjgOq5S0FDGfwTk1HrpC7NLiP-HEm0ms-MoLKfPSDSwg0mx_3uzoVunx1-hrhRRIPZB9W4y45vIa7lqiKrsmgX5K_dd0rrc0RV62EhLfJW_CBAkepfPkpYukuIMOEqN2jh-HvgDtHI_twRNHZeqgNT4jshCAUk78jaImmR_jBM-4xUE7OmLDp3E33fUu9Z3eSohs4PUIgRA0MAdxjQMwnYmNGEdThtZjZIKdcico8IrGxWYUsmRgCvqr0YRYrEbY5BwaOaXrU2Ql_i-8iPPAsmuGb4UmZ95SsY9-8wvr9JKXq0VXU5qq83SL18Px6qc4VcIZ414E_TYUWp-zlEsoa_4YpmGRXPsRSXhIKVYn-qyVg63vGTIsfgOOeVnpub8nSfBEVcEvo89BaNamaJbU2LGso5perIxni2FaPaiqq-8hNPh9pZYKcPDt9TssC9p7bCzBlW1fcyow2mfBwiFQ0=w448-h796-no)

イベントの追加画面はこう

![追加](https://lh3.googleusercontent.com/7H975szAV8PRzGwpWFw9qb0zZ5X4T6KUOIbWrkGYaa1_ztSnLuQrvJF9kLYJ83s1cUmJW1UciAydsXZ0lbWCU4L9FsEgyVpy_UyaXvjCowgBwF8KLhWH4hhnNH_GcfK7AGBtYGb2PDTqQPFOZuPm0QVnxPOH5c2TTeB26pOikHQJhSNbjV_1mQhEzj6Opb0ygEGeWRewW-0ILxKmwHRYLV2FU3fMRPE_L2nlUiC4VPi0ksmFRWLsgct36FV_e7-glg-6VJtOHyshT_HxfkQTZ4xolGzYnMELcsK0EP2OsibRry0vg3A1LFCo_p1EVb6M8fnPAqUI6PbQDp0I3mI0AdkBEjabEb8qtLRs-uCaiohkgcS7fPAj47YCNVICw28x5uR0qDCY7kbTPWD2EDsLD7rbnIphOD8fziTAk3j7HePkkrNwH2p0n0DlW_LV8jfGpHFPdrlP3keLg6_2CL-D9oxexUJ7NK6LD-2aZt1vZXWoraoq3_76GN4IPFE57cVMxKfI46ixYU4j5D3ZIUHB5LwN07-ZaJpo0n2cqBW2oSeWNt8QUJi8aPZy_qjq7LVkIz5z3oxlsj0i7pwmvkXgv2tCYSAICFLSWkdUMrqswMaAdT8dn2p9Zi06VlCZ93w=w448-h796-no)

各イベントの詳細では履歴が一覧できます。FABから新しい履歴を追加

![詳細](https://lh3.googleusercontent.com/uhU8mu23MCPu8rI55hq93D1qiWjwg2YH-vUCYGQzeOesgXz2qLY8jqxY881J7CTioTSDtZkBuV44p3dVK2d1DdhaoR7iRSHhAUT5yfCwXXMhX3g7aAJUzDW12D78BW0YGhQzzmNREC-FrgEZHd7s2Muec5Xif-bo2B3c_j3YxggzbV_sre6eZmKTz4hxVOGcCIM8jcmM6mNVEEUVZRem_XbCN1z_-U0oGjTkMGjTApMPFcyH1ZDVpB1KTux8KV1XDYXgp6S3cCbsnLuzFOxOR4djQUcdr-kcnYAVZ1qWrZDran4mHbmRBJo4FhQKA-IpzA8vlhVsCp_EDtNdINKk6AVHzx31kJUOPsVTym49WuHOiHjvkMbcRzsclVmheMxATgocYAhme0VcTbizxrpjK2lIWtbX094cA2bSK2X4YwrLpA2C2pdEcmQT0mP_8CMMqeR3_zldkHZkt8Ho1-vA3o9drPvVbHatNFTKoa1KmFszYPfcKZkGhP0Qx3tvJKmQymbQ3SkyKbduf0V1AKzfkgRT6YajdraqDJAOTXUDgGaUAsNGmrquqrZ68wX3hGe0IfWUll3Zc18XsI6ytO905yEY_ZPQPf0E_04bMrOjxm36MgJwmCLoDjMYETYSt-Q=w448-h796-no)


今回はGoogle I/O 2018で発表された新しいMaterial Designを意識して作っています。

## アイコン

今までは[99designs](https://99designs.jp/)で依頼してたのですが、今回はSketchで自作してみました。  
素人にしてはソレっぽいのができてかなり気に入っています。  
Material Designはガイドラインがしっかりしているので、やっぱいいですね。


## 今後の展望

もうちょっとほしい機能があるので、引き続き開発は続けていくつもりです。

- ダークテーマ
- タイマー
- 課金で広告非表示
- 検索

# ※ここから下は技術者向け ----------

## 使った技術とか

Android Architecture Components(以後AAC)をガッツリ使ってます。  
最近は公式のライブラリが充実してきたので、迷うことが減っていいですね。初心者的には学ぶことが増えて一長一短でしょうけど…。

最初はSingle Activityな構成にしようかと思ったんですが、「Toolbarの形が大きく異なる場合にどうするの？」という問題をうまく解決できそうになかったので、Activityは各画面で別になっています。  
この問題、[googlesamples/android-sunflower](https://github.com/googlesamples/android-sunflower)でも[issueがあがっていて](https://github.com/googlesamples/android-sunflower/issues/75)、まだ公式でも意見がまとまっていないようです。うまいこと解決できるといいのですが。

データベースはAACのRoomを使っています。RxJavaやLiveDataによるリアクティブな使い方をサポートしていて、ホントに使いやすいです。  
なにより、自分で書いたSQLの結果をクラスに楽にマッピングでき最高です。もうテーブル構成まんまなデータをプレゼンテーション層で使う時代は終わったのです。  
2.1.0からはFTSやViewもサポートするようなので、今後 `LIKE` を使わない検索の実装にも役立ちそうです。自力でN-gram的なことをしなきゃなんで、また別の困難はありそうですが。


### Architecture?

Clean Architecture x MVIな感じです。  
AACのViewModelがUsecaseとReducerを持ち、画面のState(Kotlinのdata class)をLiveDataでFragmentに公開しています。  

AndroidだとWebの仮想DOM的な差分更新の仕組みがないので、新しいStateとViewの状態を比べて更新の可否を決めるようなコードを書くことになり、若干手間はかかります。  

Stateの更新場所がまとまるのは大変良いので、[AirbnbのMvRx](https://github.com/airbnb/MvRx)とかいろいろ先達を参考にしつつよい方法を模索していきたいです。


参考
- PlayStoreリンク: https://play.google.com/store/apps/details?id=com.codingfeline.sincetimer
